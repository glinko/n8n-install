# üìã –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é Telegram-–±–æ—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### üîÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é

**–î–æ:**
```
üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:
  ‚îú‚îÄ ChatGPT
  ‚îú‚îÄ Sysopka
  ‚îî‚îÄ People
```

**–ü–æ—Å–ª–µ:**
```
üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:
  ‚îú‚îÄ Agent          (–ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê)
  ‚îú‚îÄ Sysopka
  ‚îî‚îÄ People

üìÇ –ü–æ–¥–º–µ–Ω—é Sysopka:
  ‚îú‚îÄ ChatGPT        (–ü–ï–†–ï–ú–ï–©–ï–ù–û)
  ‚îú‚îÄ ClaudeCLI
  ‚îú‚îÄ CursorCLI
  ‚îú‚îÄ ProxMox
  ‚îî‚îÄ HomeNET
```

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ/—Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `app/main.py`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `from .routers import agent as agent_router` (—Å—Ç—Ä–æ–∫–∞ 19)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `MENU_STRUCTURE` (—Å—Ç—Ä–æ–∫–∏ 30-111):
  - –°–æ–∑–¥–∞–Ω –ø—É–Ω–∫—Ç `AGENT` –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
  - –°–æ–∑–¥–∞–Ω –ø—É–Ω–∫—Ç `SYSOPKA_CHATGPT` –≤ –ø–æ–¥–º–µ–Ω—é Sysopka
  - –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –ø—É–Ω–∫—Ç `CHATGPT` –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
- ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Ä–æ—É—Ç–µ—Ä: `dp.include_router(agent_router.router)` (—Å—Ç—Ä–æ–∫–∞ 308)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `"CHATGPT"` –≤ —Å–ø–∏—Å–æ–∫ legacy_keys –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 167)

### 2. `app/routers/start.py`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `action_type == "agent"` (—Å—Ç—Ä–æ–∫–∏ 150-153):
```python
elif item.action_type == "agent":
    from .agent import start_agent
    await start_agent(message, state, db_user)
```

### 3. `app/states/agent.py` (–ù–û–í–´–ô –§–ê–ô–õ)
**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```python
from aiogram.fsm.state import State, StatesGroup

class AgentState(StatesGroup):
    waiting_for_message = State()
```

### 4. `app/routers/agent.py` (–ù–û–í–´–ô –§–ê–ô–õ)
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Agent-—Ä–µ–∂–∏–º–∞
- FSM-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è `/exit`, `/start` –∏ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –§—É–Ω–∫—Ü–∏—è `start_agent()` –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Ä–µ–∂–∏–º Agent
- –ü–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª—É—à–∫—É: "ü§ñ Agent (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)"

---

## üéØ –¢–µ–∫—É—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–Ω–æ–ø–∫–∏ Agent

–ö–Ω–æ–ø–∫–∞ Agent —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –∑–∞–≥–ª—É—à–∫–∏:
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ FSM-—Å–æ—Å—Ç–æ—è–Ω–∏–µ `AgentState.waiting_for_message`
- –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "ü§ñ Agent (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)"
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–æ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã `/exit` –∏ `/start` –¥–ª—è –≤—ã—Ö–æ–¥–∞

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n/Flowise

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Flowise AgentFlow
–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ–Ω—é –≤ `main.py`:
```python
{
    "key": "AGENT",
    "label": "Agent",
    "parent_key": None,
    "roles": None,
    "sort_order": 10,
    "is_active": True,
    "action_type": "flowise_agentflow",  # –∏–∑–º–µ–Ω–∏—Ç—å —Å "agent"
    "action_config": {"agentflow_id": "YOUR_AGENTFLOW_ID"},  # –¥–æ–±–∞–≤–∏—Ç—å ID
},
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–∞—Å—Ç–æ–º–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `app/routers/agent.py`:
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `handle_agent_query()` –∑–∞–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –Ω–∞ –≤—ã–∑–æ–≤ n8n/Flowise API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `flowise_client.py` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø—è—Ç –≤ —Å–∏–ª—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:
```bash
cd /home/claude/workspace/tg-bot
docker-compose restart tg-bot  # –∏–ª–∏ –∫–∞–∫ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∑–∞–ø—É—Å–∫
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:
- –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é –≤ –ë–î
- –°—Ç–∞—Ä—ã–π –ø—É–Ω–∫—Ç `CHATGPT` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –º–µ–Ω—é

---

## ‚úÖ Checklist

- [x] ChatGPT –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –ø–æ–¥–º–µ–Ω—é Sysopka
- [x] –°–æ–∑–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ Agent –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
- [x] –°–æ–∑–¥–∞–Ω —Ä–æ—É—Ç–µ—Ä `app/routers/agent.py`
- [x] –°–æ–∑–¥–∞–Ω state `app/states/agent.py`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `app/main.py`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `app/routers/start.py`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å n8n/Flowise (TODO)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ (TODO)

