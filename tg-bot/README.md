# Telegram Bot –¥–ª—è n8n-install

–ú—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π Telegram –±–æ—Ç —Å –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
- **–ú–µ–Ω—é –≤ –ë–î** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PostgreSQL, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞** - superadmin –∏ user —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –¥–æ—Å—Ç—É–ø–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å n8n, RAGApp, Qdrant, Supabase –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îÇ   ‚îú‚îÄ‚îÄ db.py              # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # SQLAlchemy –º–æ–¥–µ–ª–∏ (User, UserEvent, MenuItem)
‚îÇ   ‚îú‚îÄ‚îÄ menu.py            # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–µ–Ω—é –∏–∑ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ routers/           # –ú–æ–¥—É–ª–∏/—Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py       # /start –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py    # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py       # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin_menu.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ       ‚îî‚îÄ‚îÄ user_middleware.py  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îî‚îÄ‚îÄ .env.example
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞** —É @BotFather –≤ Telegram
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª**:
   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ —É–∫–∞–∂–∏—Ç–µ:
   # - TELEGRAM_BOT_TOKEN
   # - SUPERADMIN_IDS (–≤–∞—à Telegram user_id, –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot)
   ```

3. **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose**:
   ```bash
   cd /home/user/n8n-install
   docker compose -p localai up -d tg-bot
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**:
   ```bash
   docker compose -p localai logs -f tg-bot
   ```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞

- `/start` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/users` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/setrole <telegram_id> <role>` - –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/menu_list` - —Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—é
- `/menu_add <KEY> <label> <roles> <sort_order>` - –¥–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é
- `/menu_set_roles <KEY> <roles>` - –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª–∏ –¥–ª—è –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é
- `/menu_toggle <KEY>` - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –≤ `app/routers/`
2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `app/routers/start.py` –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞ –º–µ–Ω—é
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ `app/main.py`
4. –î–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/menu_add` –≤ –±–æ—Ç–µ

## Flowise TestChat

–ö–Ω–æ–ø–∫–∞ **üß™ TestChat** –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É Flowise chatflow (–º–æ–¥–µ–ª—å GPT-5.1). –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Flowise –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL.

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å

1. –í `.env` –∑–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   ```
   FLOWISE_BASE_URL=https://flowise.rootnode.cv
   FLOWISE_API_KEY=<flowise_api_key>
   TESTCHAT_CHATFLOW_ID=230ab8d7-9cb7-41a7-9fba-b2ca8fb2c60d
   ```
   (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `secrets`).
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `tg-bot`.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –±–æ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∂–∏–º TestChat –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Flowise.
- –°–µ—Å—Å–∏—è Flowise –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ Telegram-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø–æ—ç—Ç–æ–º—É –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Flowise.
- –ö–∞–∂–¥–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∏ –∞–≥–µ–Ω—Ç—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `test_chat_sessions` / `test_chat_messages` –¥–ª—è –∞—É–¥–∏—Ç–∞.
- –ö–æ–º–∞–Ω–¥–∞ `/exit` –≤ —Ä–µ–∂–∏–º–µ TestChat –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–µ—Å—Å–∏—é.

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–æ–π –∂–µ Docker-—Å–µ—Ç–∏, —á—Ç–æ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç—É–ø–Ω—ã:

- `http://n8n:5678` - n8n API
- `http://ragapp:8000` - RAGApp API
- `http://qdrant:6333` - Qdrant API
- `http://postgres:5432` - PostgreSQL
- `http://redis:6379` - Redis
- `http://ollama:11434` - Ollama API

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ PostgreSQL, —á—Ç–æ –∏ n8n. –°–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã:
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `user_events` - –ª–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
- `menu_items` - —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
