{
  "name": "redis_cache_manager",
  "description": "Manage Redis cache operations: get, set, delete keys, check if key exists, get TTL. Useful for caching data, session management, and temporary storage.",
  "color": "linear-gradient(rgb(220, 47, 2), rgb(186, 40, 2))",
  "iconSrc": "",
  "schema": "[{\"id\":0,\"property\":\"operation\",\"description\":\"Operation: get, set, delete, exists, ttl, keys\",\"type\":\"string\",\"required\":true},{\"id\":1,\"property\":\"key\",\"description\":\"Redis key\",\"type\":\"string\",\"required\":true},{\"id\":2,\"property\":\"value\",\"description\":\"Value to set (for 'set' operation)\",\"type\":\"string\",\"required\":false},{\"id\":3,\"property\":\"ttl_seconds\",\"description\":\"Time to live in seconds (for 'set' operation)\",\"type\":\"number\",\"required\":false}]",
  "func": "/*\n* Redis Cache Manager\n* Operations:\n* - get: Get value by key\n* - set: Set key-value pair with optional TTL\n* - delete: Delete key\n* - exists: Check if key exists\n* - ttl: Get remaining TTL for key\n* - keys: Search keys by pattern\n*/\n\nconst Redis = require('redis');\n\nconst client = Redis.createClient({\n    socket: {\n        host: $vars.redis_host || 'redis',\n        port: $vars.redis_port || 6379\n    },\n    password: $vars.redis_password || undefined\n});\n\ntry {\n    await client.connect();\n    \n    let result;\n    \n    switch ($operation.toLowerCase()) {\n        case 'get':\n            result = await client.get($key);\n            if (result === null) {\n                return `Key '${$key}' not found`;\n            }\n            return result;\n            \n        case 'set':\n            if (!$value) {\n                await client.quit();\n                return 'Error: value parameter required for set operation';\n            }\n            if ($ttl_seconds && $ttl_seconds > 0) {\n                await client.setEx($key, parseInt($ttl_seconds), $value);\n                result = `Key '${$key}' set with TTL ${$ttl_seconds}s`;\n            } else {\n                await client.set($key, $value);\n                result = `Key '${$key}' set (no expiration)`;\n            }\n            return result;\n            \n        case 'delete':\n            const deleted = await client.del($key);\n            return `Deleted ${deleted} key(s)`;\n            \n        case 'exists':\n            const exists = await client.exists($key);\n            return exists ? `Key '${$key}' exists` : `Key '${$key}' does not exist`;\n            \n        case 'ttl':\n            const ttl = await client.ttl($key);\n            if (ttl === -2) {\n                return `Key '${$key}' does not exist`;\n            } else if (ttl === -1) {\n                return `Key '${$key}' exists but has no expiration`;\n            } else {\n                return `Key '${$key}' expires in ${ttl} seconds`;\n            }\n            \n        case 'keys':\n            // $key is used as pattern here\n            const keys = await client.keys($key);\n            return JSON.stringify({ pattern: $key, count: keys.length, keys: keys }, null, 2);\n            \n        default:\n            await client.quit();\n            return `Error: Unknown operation '${$operation}'. Available: get, set, delete, exists, ttl, keys`;\n    }\n    \n} catch (error) {\n    console.error('Redis operation error:', error);\n    return `Error: ${error.message}`;\n} finally {\n    if (client.isOpen) {\n        await client.quit();\n    }\n}"
}
